<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GST Order</title>

<style>
/* =====================
   BASE (MOBILE FIRST)
===================== */
*{
  box-sizing:border-box;
  font-family:Segoe UI, Arial, sans-serif;
  font-size:13px;
}

body{
  margin:0;
  background:#eee;
}

.app{
  padding:10px;
}

/* =====================
   CARD / BOX
===================== */
.box{
  background:#fff;
  border:1px solid #d1d6de;
  padding:10px;
  border-radius:10px;
}

/* =====================
   FORM
===================== */
.row{
  display:flex;
  flex-direction:column;
  gap:4px;
  margin-bottom:8px;
}

label{
  font-weight:600;
}

input, select{
  height:30px;
  padding:5px 8px;
  border-radius:6px;
  border:1px solid #d1d6de;
}

input:focus, select:focus{
  outline:none;
  border-color:#007aff;
}

/* =====================
   HEADER
===================== */
.header{
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* =====================
   TABLE (RESPONSIVE)
===================== */
.table-wrap{
  width:100%;
  overflow-x:auto;
  margin-top:10px;
}

table{
  width:100%;
  min-width:1200px; /* forces horizontal scroll */
  border-collapse:collapse;
}

th, td{
  border:1px solid #d1d6de;
  padding:6px;
  white-space:nowrap;
}

th{
  background:#f2f4f8;
  font-weight:600;
  position:sticky;
  top:0;
}

.total{
  background:#fff2cc;
  font-weight:600;
}

/* Inputs inside table */
table input,
table select{
  width:100%;
  height:26px;
}

/* =====================
   ACTION BUTTONS
===================== */
.actions{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.actions button{
  padding:6px 14px;
  border-radius:6px;
  border:1px solid #d1d6de;
  background:#fff;
}

/* =====================
   HISTORY
===================== */
.history{
  margin-top:12px;
  border:1px solid #d1d6de;
  border-radius:10px;
  background:#fff;
}

.history h4{
  margin:0;
  padding:8px;
  background:#f2f4f8;
}

/* =====================
   INVOICE
===================== */
#invoice{
  display:none;
  padding:20px;
  background:#fff;
}

/* =====================
   PRINT
===================== */
@media print{
  .no-print{display:none;}
  body{background:#fff;}
}

/* =====================
   DESKTOP ENHANCEMENT
===================== */
@media(min-width:900px){

  .header{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:10px;
  }

  .row{
    flex-direction:row;
    align-items:center;
  }

  label{
    min-width:90px;
  }
}


</style>
</head>

<body>

<div class="app no-print" id="orderApp">

<!-- HEADER -->
<div class="header">
  <div class="box">
    <div class="row">
      <label>New A/c</label>
      <input id="customer" readonly onclick="openCustomer()" placeholder="Select Customer">
    </div>
    <div class="row">
      <label>Search</label>
      <input readonly onclick="openCustomer()" placeholder="Open Customer List">
    </div>
  </div>

  <div class="box">
    <div class="row">
      <label>Order Date</label>
      <input type="date" id="orderDate">
    </div>
    <div class="row">
      <label>Due Date</label>
      <input type="date" id="dueDate">
    </div>
  </div>

  <div class="box">
    <strong>GST ORDER</strong><br>
    Bill No: <input id="billNo" style="width:90px">
  </div>
</div>

<!-- ITEMS TABLE -->
<table id="itemTable">
<thead>
<tr>
  <th>Type</th><th>Job No.</th><th>Item Name</th><th>Stamp</th><th>Remarks</th>
  <th>Design</th><th>Size</th><th>Pc</th><th>Gr.Wt.</th><th>Less</th>
  <th>Net.Wt.</th><th>Rate</th><th>Dia.Wt.</th><th>Stn.Wt.</th>
  <th>Lbr.%</th><th class="total">Total</th><th>‚ùå</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- ACTIONS -->
<div class="actions">
  <button onclick="addRow()">‚ûï Add Row</button>
  <button onclick="openReceipt()">üßæ Receipt</button>
  <button onclick="openPayment()">üí∞ Payment</button>
  <button onclick="openRateBook()">üìò Rate Book</button>
  <button onclick="saveBill()">üíæ Save Bill</button>
  <button onclick="showInvoice()">üßæ A4 Invoice</button>
</div>

<!-- BILL HISTORY -->
<div class="history">
  <h4>Bill History</h4>
  <table width="100%">
    <thead><tr><th>Date</th><th>Bill No</th><th>Customer</th></tr></thead>
    <tbody id="historyBody"></tbody>
  </table>
</div>

</div>

<!-- INVOICE -->
<div id="invoice">
  <button class="no-print" onclick="back()">‚Üê Back</button>
  <button class="no-print" onclick="window.print()">Print</button>
  <h2 style="text-align:center">GST TAX INVOICE</h2>
  <p>
    <strong>Customer:</strong> <span id="iCustomer"></span><br>
    <strong>Order Date:</strong> <span id="iOrderDate"></span><br>
    <strong>Bill No:</strong> <span id="iBillNo"></span>
  </p>
  <table width="100%">
    <thead><tr><th>Item</th><th>Pc</th><th>Net Wt</th><th>Rate</th><th>Total</th></tr></thead>
    <tbody id="iItems"></tbody>
  </table>
  <h3 style="text-align:right">Grand Total: ‚Çπ <span id="iGrand"></span></h3>
</div>

<script>
/* INIT */
document.getElementById("orderDate").valueAsDate = new Date();
addRow();
loadHistory();

/* CUSTOMER */
function openCustomer(){
  window.open("customer.html","Customer","width=1200,height=700");
}
function setCustomerName(name){
  document.getElementById("customer").value = name;
}

/* ROWS */
function addRow(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
<td><select><option>Order</option><option>Repair</option><option>Sale</option><option>Purchase</option></select></td>
<td><input></td><td><input></td><td><input></td><td><input></td>
<td><input></td><td><input></td>
<td><input oninput="calc(this)"></td>
<td><input readonly></td>
<td><input oninput="calc(this)"></td>
<td><input readonly></td>
<td><input oninput="calc(this)"></td>
<td><input></td><td><input></td>
<td><input oninput="calc(this)"></td>
<td class="total"><input readonly></td>
<td><button onclick="this.closest('tr').remove()">X</button></td>`;
  document.querySelector("#itemTable tbody").appendChild(tr);
}

/* CALC */
function calc(el){
  const r=el.closest("tr");
  const pc=+r.cells[7].children[0].value||0;
  const less=+r.cells[9].children[0].value||0;
  const rate=+r.cells[11].children[0].value||0;
  const lbr=+r.cells[14].children[0].value||0;
  const grwt=pc*10;
  const net=grwt-less;
  const base=net*rate;
  const total=base+(base*lbr/100);
  r.cells[8].children[0].value=grwt;
  r.cells[10].children[0].value=net;
  r.cells[15].children[0].value=total.toFixed(2);
}

/* SAVE & HISTORY */
function saveBill(){
  if(!customer.value){alert("Select customer");return;}
  const bills=JSON.parse(localStorage.getItem("bills")||"[]");
  const rows=[...document.querySelectorAll("#itemTable tbody tr")].map(r=>
    [...r.querySelectorAll("input,select")].map(e=>e.value)
  );
  bills.push({date:orderDate.value,billNo:billNo.value,customer:customer.value,rows});
  localStorage.setItem("bills",JSON.stringify(bills));
  loadHistory();
  alert("Bill saved");
}
function loadHistory(){
  const bills=JSON.parse(localStorage.getItem("bills")||"[]");
  historyBody.innerHTML="";
  bills.forEach((b,i)=>{
    historyBody.innerHTML+=`<tr onclick="loadBill(${i})"><td>${b.date}</td><td>${b.billNo}</td><td>${b.customer}</td></tr>`;
  });
}
function loadBill(i){
  const b=JSON.parse(localStorage.getItem("bills"))[i];
  customer.value=b.customer; orderDate.value=b.date; billNo.value=b.billNo;
  document.querySelector("#itemTable tbody").innerHTML="";
  b.rows.forEach(r=>{
    addRow();
    [...document.querySelector("#itemTable tbody tr:last-child").querySelectorAll("input,select")]
      .forEach((e,j)=>e.value=r[j]);
  });
}

/* INVOICE */
function showInvoice(){
  iCustomer.textContent=customer.value;
  iOrderDate.textContent=orderDate.value;
  iBillNo.textContent=billNo.value;
  iItems.innerHTML=""; let g=0;
  document.querySelectorAll("#itemTable tbody tr").forEach(r=>{
    const t=r.cells[15].children[0].value; g+=+t||0;
    iItems.innerHTML+=`<tr><td>${r.cells[2].children[0].value}</td><td>${r.cells[7].children[0].value}</td><td>${r.cells[10].children[0].value}</td><td>${r.cells[11].children[0].value}</td><td>${t}</td></tr>`;
  });
  iGrand.textContent=g.toFixed(2);
  orderApp.style.display="none"; invoice.style.display="block";
}
function back(){ invoice.style.display="none"; orderApp.style.display="block"; }

/* NAV BUTTONS */
function openReceipt(){
  if(!customer.value){alert("Select customer");return;}
  window.open(`receipt.html?customer=${encodeURIComponent(customer.value)}&billNo=${encodeURIComponent(billNo.value)}`,"Receipt","width=900,height=650");
}
function openPayment(){
  if(!customer.value){alert("Select customer");return;}
  window.open(`payment.html?customer=${encodeURIComponent(customer.value)}&billNo=${encodeURIComponent(billNo.value)}`,"Payment","width=900,height=650");
}
function openRateBook(){
  window.open("ratebook.html","RateBook","width=900,height=650");
}
</script>

</body>
</html>
